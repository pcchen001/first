<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JavaScript éåŒæ­¥è™•ç†èˆ‡ API ç¤ºç¯„</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', 'å¾®è»Ÿæ­£é»‘é«”', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 40px 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 10px;
            font-size: 36px;
        }

        .subtitle {
            color: rgba(255, 255, 255, 0.8);
            text-align: center;
            margin-bottom: 40px;
            font-size: 16px;
        }

        section {
            background: white;
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 40px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        section h2 {
            color: #333;
            margin-bottom: 25px;
            font-size: 24px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        h3 {
            color: #555;
            margin-top: 20px;
            margin-bottom: 15px;
            font-size: 18px;
        }

        /* ==================== æŒ‰éˆ•æ¨£å¼ ==================== */
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            margin-right: 10px;
            margin-bottom: 10px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .btn-info {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        /* ==================== æ¼”ç¤ºå®¹å™¨ ==================== */
        .demo-box {
            background: #f0f0f0;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
        }

        .demo-output {
            background: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            margin-top: 10px;
            min-height: 50px;
            color: #333;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-all;
            line-height: 1.6;
        }

        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            margin: 15px 0;
            border-left: 4px solid #667eea;
            line-height: 1.5;
        }

        .description {
            background: rgba(102, 126, 234, 0.1);
            border-left: 4px solid #667eea;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            color: #333;
            line-height: 1.6;
            font-size: 14px;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 15px 0;
        }

        .comparison-box {
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
        }

        .comparison-box h4 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .comparison-box .code-block {
            margin: 10px 0;
            font-size: 12px;
        }

        .feature-list {
            list-style: none;
            padding: 0;
        }

        .feature-list li {
            padding: 8px 0;
            padding-left: 25px;
            position: relative;
            color: #333;
            font-size: 14px;
            border-bottom: 1px solid #eee;
        }

        .feature-list li:before {
            content: "âœ“";
            position: absolute;
            left: 0;
            color: #11998e;
            font-weight: bold;
        }

        .method-card {
            background: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }

        .method-card h4 {
            color: #667eea;
            margin-bottom: 8px;
            font-size: 15px;
        }

        .method-tag {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 11px;
            margin-right: 5px;
            margin-bottom: 8px;
        }

        .method-tag.async {
            background: #4facfe;
        }

        .method-tag.promise {
            background: #f5576c;
        }

        .demo-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            margin: 10px 0;
        }

        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #667eea;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-right: 8px;
            vertical-align: middle;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-right: 10px;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-success {
            background: #d4edda;
            color: #155724;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
        }

        .response-card {
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }

        .response-card h5 {
            color: #333;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .response-data {
            background: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 12px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            overflow-x: auto;
            max-height: 300px;
            overflow-y: auto;
        }

        /* ==================== éŸ¿æ‡‰å¼ ==================== */
        @media (max-width: 768px) {
            h1 {
                font-size: 28px;
            }

            .comparison-grid {
                grid-template-columns: 1fr;
            }

            section {
                padding: 20px;
            }
        }

        footer {
            text-align: center;
            color: rgba(255, 255, 255, 0.8);
            padding: 30px 20px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>â³ JavaScript éåŒæ­¥è™•ç†èˆ‡ API è©³ç´°ç¤ºç¯„</h1>
        <p class="subtitle">æŒæ¡ Promiseã€Async/Await å’Œ API å‘¼å«</p>

        <!-- ==================== éåŒæ­¥åŸºç¤ ==================== -->
        <section>
            <h2>ğŸ”„ éåŒæ­¥åŸºç¤æ¦‚å¿µ</h2>

            <h3>åŒæ­¥ vs éåŒæ­¥</h3>
            <div class="demo-box">
                <button onclick="demoSynchronous()">åŸ·è¡ŒåŒæ­¥ç¤ºç¯„</button>
                <button onclick="demoAsynchronous()">åŸ·è¡ŒéåŒæ­¥ç¤ºç¯„</button>
                <div class="demo-output" id="sync-async-output"></div>
            </div>

            <div class="comparison-grid">
                <div class="comparison-box">
                    <h4>âŒ åŒæ­¥ (Synchronous)</h4>
                    <div class="code-block">
// ä»£ç¢¼ä¾æ¬¡åŸ·è¡Œ
console.log('é–‹å§‹');

// è€—æ™‚æ“ä½œ (é˜»å¡)
for (let i = 0; i < 1000000000; i++) {}

console.log('çµæŸ');
// çµæœ: é˜»å¡æ•´å€‹ç¨‹åº
                    </div>
                </div>
                <div class="comparison-box">
                    <h4>âœ… éåŒæ­¥ (Asynchronous)</h4>
                    <div class="code-block">
// è€—æ™‚æ“ä½œä¸é˜»å¡
console.log('é–‹å§‹');

setTimeout(() => {
    console.log('çµæŸ');
}, 1000);

// å…¶ä»–ä»£ç¢¼ç¹¼çºŒåŸ·è¡Œ
                    </div>
                </div>
            </div>

            <div class="description">
                <strong>ç‚ºä»€éº¼éœ€è¦éåŒæ­¥ï¼Ÿ</strong><br>
                â€¢ é¿å…é˜»å¡ UI<br>
                â€¢ æé«˜ç¨‹åºéŸ¿æ‡‰æ€§<br>
                â€¢ æå‡ç”¨æˆ¶é«”é©—<br>
                â€¢ æ­£ç¢ºè™•ç† I/O æ“ä½œ
            </div>
        </section>

        <!-- ==================== å›èª¿å‡½æ•¸ ==================== -->
        <section>
            <h2>ğŸ“ å›èª¿å‡½æ•¸ (Callback)</h2>

            <div class="method-card">
                <h4>åŸºæœ¬å›èª¿æ¦‚å¿µ</h4>
                <button onclick="demoCallback()">åŸ·è¡Œç¤ºç¯„</button>
                <div class="demo-output" id="callback-output"></div>
                <div class="code-block">
// åŸºæœ¬å›èª¿
function fetchData(callback) {
    setTimeout(() => {
        const data = { id: 1, name: 'Alice' };
        callback(data);
    }, 1000);
}

fetchData((data) => {
    console.log('ç²å¾—æ•¸æ“š:', data);
});

// å¸¶éŒ¯èª¤è™•ç†çš„å›èª¿
function fetchDataWithError(success, error) {
    setTimeout(() => {
        if (Math.random() > 0.5) {
            success({ id: 1, name: 'Alice' });
        } else {
            error('è«‹æ±‚å¤±æ•—');
        }
    }, 1000);
}

fetchDataWithError(
    (data) => console.log('æˆåŠŸ:', data),
    (err) => console.error('å¤±æ•—:', err)
);
                </div>
            </div>

            <div class="description">
                <strong>å›èª¿åœ°ç„ (Callback Hell)ï¼š</strong><br>
                ç•¶å›èª¿åµŒå¥—å¤ªæ·±æ™‚ï¼Œä»£ç¢¼è®Šå¾—é›£ä»¥é–±è®€å’Œç¶­è­·ã€‚é€™å°±æ˜¯ç‚ºä»€éº¼ Promise å’Œ Async/Await è¢«å¼•å…¥ã€‚
            </div>

            <div class="code-block">
// âŒ å›èª¿åœ°ç„
fetchUser((user) => {
    fetchPosts(user.id, (posts) => {
        fetchComments(posts[0].id, (comments) => {
            fetchReplies(comments[0].id, (replies) => {
                console.log(replies);
            });
        });
    });
});
            </div>
        </section>

        <!-- ==================== Promise ==================== -->
        <section>
            <h2>ğŸ¤ Promise</h2>

            <div class="method-card">
                <h4>Promise çš„ä¸‰å€‹ç‹€æ…‹</h4>
                <button onclick="demoPromiseStates()">åŸ·è¡Œç¤ºç¯„</button>
                <div class="demo-output" id="promise-states-output"></div>
                <div class="code-block">
// Pending (å¾…æ©Ÿ) â†’ Fulfilled (æˆåŠŸ) æˆ– Rejected (å¤±æ•—)

const promise = new Promise((resolve, reject) => {
    // éåŒæ­¥æ“ä½œ
    setTimeout(() => {
        if (Math.random() > 0.5) {
            resolve('æˆåŠŸ!'); // è½‰ç‚º Fulfilled
        } else {
            reject('å¤±æ•—!'); // è½‰ç‚º Rejected
        }
    }, 1000);
});

// ç‹€æ…‹ç¢ºå®šå¾Œä¸æœƒæ”¹è®Š (Immutable)
promise
    .then(result => console.log('çµæœ:', result))
    .catch(error => console.error('éŒ¯èª¤:', error));
                </div>
            </div>

            <div class="method-card">
                <h4>Promise éˆå¼èª¿ç”¨</h4>
                <button onclick="demoPromiseChain()">åŸ·è¡Œç¤ºç¯„</button>
                <div class="demo-output" id="promise-chain-output"></div>
                <div class="code-block">
// âœ… Promise éˆå¼ (é¿å…å›èª¿åœ°ç„)
fetchUser(1)
    .then(user => {
        console.log('ç²å¾—ç”¨æˆ¶:', user);
        return fetchPosts(user.id);
    })
    .then(posts => {
        console.log('ç²å¾—æ–‡ç« :', posts);
        return posts[0];
    })
    .catch(error => {
        console.error('ç™¼ç”ŸéŒ¯èª¤:', error);
    })
    .finally(() => {
        console.log('æ“ä½œå®Œæˆ');
    });

// é—œéµé»ï¼šæ¯å€‹ then è¿”å›æ–°çš„ Promise
                </div>
            </div>

            <div class="method-card">
                <h4>Promise.all() - ç­‰å¾…æ‰€æœ‰ Promise</h4>
                <button onclick="demoPromiseAll()">åŸ·è¡Œç¤ºç¯„</button>
                <div class="demo-output" id="promise-all-output"></div>
                <div class="code-block">
// åŒæ™‚ç™¼èµ·å¤šå€‹è«‹æ±‚
Promise.all([
    fetch('/api/users'),
    fetch('/api/posts'),
    fetch('/api/comments')
])
.then(responses => {
    console.log('å…¨éƒ¨å®Œæˆ');
    return Promise.all(responses.map(r => r.json()));
})
.then(data => {
    console.log('ç”¨æˆ¶:', data[0]);
    console.log('æ–‡ç« :', data[1]);
    console.log('è©•è«–:', data[2]);
})
.catch(error => {
    // ä»»ä½•ä¸€å€‹å¤±æ•—å°±æœƒé€²å…¥ catch
    console.error('æŸå€‹è«‹æ±‚å¤±æ•—:', error);
});
                </div>
            </div>

            <div class="method-card">
                <h4>Promise.race() - ç­‰å¾…ç¬¬ä¸€å€‹ Promise</h4>
                <button onclick="demoPromiseRace()">åŸ·è¡Œç¤ºç¯„</button>
                <div class="demo-output" id="promise-race-output"></div>
                <div class="code-block">
// ç«¶é€Ÿï¼šè¿”å›ç¬¬ä¸€å€‹å®Œæˆçš„
const timeoutPromise = new Promise((resolve, reject) =>
    setTimeout(() => reject('è¶…æ™‚'), 5000)
);

Promise.race([
    fetch('/api/data'),
    timeoutPromise
])
.then(response => console.log('è«‹æ±‚æˆåŠŸ'))
.catch(error => console.error('è«‹æ±‚è¶…æ™‚æˆ–å¤±æ•—:', error));
                </div>
            </div>

            <div class="method-card">
                <h4>Promise.allSettled() - ç­‰å¾…æ‰€æœ‰å®Œæˆ</h4>
                <button onclick="demoPromiseAllSettled()">åŸ·è¡Œç¤ºç¯„</button>
                <div class="demo-output" id="promise-allsettled-output"></div>
                <div class="code-block">
// ä¸ç®¡æˆåŠŸæˆ–å¤±æ•—ï¼Œéƒ½æœƒç­‰å¾…
Promise.allSettled([
    fetch('/api/users'),
    fetch('/api/invalid'),
    fetch('/api/posts')
])
.then(results => {
    results.forEach((result, index) => {
        if (result.status === 'fulfilled') {
            console.log(`è«‹æ±‚ ${index} æˆåŠŸ:`, result.value);
        } else {
            console.log(`è«‹æ±‚ ${index} å¤±æ•—:`, result.reason);
        }
    });
});

// çµæœ: [
//     { status: 'fulfilled', value: ... },
//     { status: 'rejected', reason: ... },
//     { status: 'fulfilled', value: ... }
// ]
                </div>
            </div>

            <div class="method-card">
                <h4>Promise.any() - ç­‰å¾…ç¬¬ä¸€å€‹æˆåŠŸ</h4>
                <span class="method-tag promise">ES2021</span>
                <button onclick="demoPromiseAny()">åŸ·è¡Œç¤ºç¯„</button>
                <div class="demo-output" id="promise-any-output"></div>
                <div class="code-block">
// ç¬¬ä¸€å€‹æˆåŠŸå°±è¿”å›ï¼Œå…¨éƒ¨å¤±æ•—æ‰ reject
Promise.any([
    fetch('/api/mirror1'),
    fetch('/api/mirror2'),
    fetch('/api/mirror3')
])
.then(response => {
    console.log('è‡³å°‘æœ‰ä¸€å€‹é¡åƒå¯ç”¨');
})
.catch(error => {
    // AggregateError: æ‰€æœ‰ Promise éƒ½å¤±æ•—
    console.error('æ‰€æœ‰é¡åƒéƒ½ä¸å¯ç”¨');
});
                </div>
            </div>
        </section>

        <!-- ==================== Async/Await ==================== -->
        <section>
            <h2>â¸ï¸ Async/Await (æ¨è–¦)</h2>

            <div class="method-card">
                <h4>åŸºæœ¬ Async/Await èªæ³•</h4>
                <button onclick="demoAsyncAwaitBasic()">åŸ·è¡Œç¤ºç¯„</button>
                <div class="demo-output" id="async-await-basic-output"></div>
                <div class="code-block">
// âœ… ç¾ä»£æ–¹å¼ï¼šä»£ç¢¼çœ‹èµ·ä¾†åƒåŒæ­¥
async function getUserData(userId) {
    try {
        // ç­‰å¾… Promise è§£æ±º
        const user = await fetchUser(userId);
        console.log('ç²å¾—ç”¨æˆ¶:', user);
        
        const posts = await fetchPosts(user.id);
        console.log('ç²å¾—æ–‡ç« :', posts);
        
        return { user, posts };
    } catch (error) {
        console.error('éŒ¯èª¤:', error);
    } finally {
        console.log('æ•¸æ“šåŠ è¼‰å®Œæˆ');
    }
}

// èª¿ç”¨ async å‡½æ•¸
await getUserData(1);
                </div>
            </div>

            <div class="method-card">
                <h4>ä¸¦è¡ŒåŸ·è¡Œ (Parallel Execution)</h4>
                <button onclick="demoParallelExecution()">åŸ·è¡Œç¤ºç¯„</button>
                <div class="demo-output" id="parallel-output"></div>
                <div class="code-block">
// âŒ éŒ¯èª¤ï¼šé †åºåŸ·è¡Œ (æµªè²»æ™‚é–“)
async function slowWay() {
    const user = await fetchUser(1); // 1ç§’
    const posts = await fetchPosts(1); // 1ç§’
    const comments = await fetchComments(1); // 1ç§’
    // ç¸½è€—æ™‚: 3ç§’
}

// âœ… æ­£ç¢ºï¼šä¸¦è¡ŒåŸ·è¡Œ
async function fastWay() {
    // åŒæ™‚å•Ÿå‹•æ‰€æœ‰è«‹æ±‚
    const [user, posts, comments] = await Promise.all([
        fetchUser(1),
        fetchPosts(1),
        fetchComments(1)
    ]);
    // ç¸½è€—æ™‚: 1ç§’ (æœ€é•·çš„é‚£å€‹)
}
                </div>
            </div>

            <div class="method-card">
                <h4>éŒ¯èª¤è™•ç†</h4>
                <button onclick="demoErrorHandling()">åŸ·è¡Œç¤ºç¯„</button>
                <div class="demo-output" id="error-handling-output"></div>
                <div class="code-block">
async function robustFetch() {
    try {
        const response = await fetch('/api/data');
        
        // æª¢æŸ¥ HTTP ç‹€æ…‹
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        return data;
        
    } catch (error) {
        // æ•ç²ç¶²çµ¡éŒ¯èª¤å’Œ JSON è§£æéŒ¯èª¤
        if (error instanceof TypeError) {
            console.error('ç¶²çµ¡éŒ¯èª¤:', error.message);
        } else if (error instanceof SyntaxError) {
            console.error('JSON è§£æå¤±æ•—:', error.message);
        } else {
            console.error('å…¶ä»–éŒ¯èª¤:', error.message);
        }
        throw error; // é‡æ–°æ‹‹å‡º
        
    } finally {
        console.log('è«‹æ±‚å®Œæˆ');
    }
}
                </div>
            </div>

            <div class="method-card">
                <h4>é‡è©¦æ©Ÿåˆ¶ (Retry Logic)</h4>
                <button onclick="demoRetryLogic()">åŸ·è¡Œç¤ºç¯„</button>
                <div class="demo-output" id="retry-output"></div>
                <div class="code-block">
async function fetchWithRetry(url, maxRetries = 3) {
    for (let i = 0; i < maxRetries; i++) {
        try {
            const response = await fetch(url);
            if (response.ok) return response;
        } catch (error) {
            if (i === maxRetries - 1) throw error;
            // å»¶é²å¾Œé‡è©¦
            await new Promise(r => setTimeout(r, 1000 * (i + 1)));
        }
    }
}

// ä½¿ç”¨
try {
    const response = await fetchWithRetry('/api/data', 3);
    const data = await response.json();
} catch (error) {
    console.error('æœ€çµ‚å¤±æ•—:', error);
}
                </div>
            </div>
        </section>

        <!-- ==================== Fetch API ==================== -->
        <section>
            <h2>ğŸŒ Fetch API</h2>

            <div class="method-card">
                <h4>åŸºæœ¬ GET è«‹æ±‚</h4>
                <button onclick="demoFetchGET()">åŸ·è¡Œ GET è«‹æ±‚</button>
                <div class="demo-output" id="fetch-get-output"></div>
                <div class="code-block">
// æœ€ç°¡å–®çš„ GET è«‹æ±‚
async function fetchData() {
    try {
        const response = await fetch('https://jsonplaceholder.typicode.com/users/1');
        
        // response æ˜¯ä¸€å€‹ Response ç‰©ä»¶
        console.log('ç‹€æ…‹ç¢¼:', response.status);
        console.log('OK:', response.ok);
        console.log('Headers:', response.headers);
        
        const data = await response.json();
        console.log('æ•¸æ“š:', data);
        
    } catch (error) {
        console.error('è«‹æ±‚å¤±æ•—:', error);
    }
}
                </div>
            </div>

            <div class="method-card">
                <h4>POST è«‹æ±‚ (ç™¼é€æ•¸æ“š)</h4>
                <button onclick="demoFetchPOST()">åŸ·è¡Œ POST è«‹æ±‚</button>
                <div class="demo-output" id="fetch-post-output"></div>
                <div class="code-block">
async function createUser() {
    const newUser = {
        name: 'Alice',
        email: 'alice@example.com',
        phone: '123-456-7890'
    };
    
    try {
        const response = await fetch(
            'https://jsonplaceholder.typicode.com/users',
            {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(newUser)
            }
        );
        
        const result = await response.json();
        console.log('å‰µå»ºæˆåŠŸ:', result);
        
    } catch (error) {
        console.error('è«‹æ±‚å¤±æ•—:', error);
    }
}
                </div>
            </div>

            <div class="method-card">
                <h4>PUT/PATCH è«‹æ±‚ (æ›´æ–°æ•¸æ“š)</h4>
                <button onclick="demoFetchPUT()">åŸ·è¡Œ PUT è«‹æ±‚</button>
                <div class="demo-output" id="fetch-put-output"></div>
                <div class="code-block">
// PUT: æ›¿æ›æ•´å€‹è³‡æº
async function updateUser(userId) {
    const updatedUser = {
        name: 'Bob',
        email: 'bob@example.com'
    };
    
    const response = await fetch(
        `https://jsonplaceholder.typicode.com/users/${userId}`,
        {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(updatedUser)
        }
    );
    
    return await response.json();
}

// PATCH: éƒ¨åˆ†æ›´æ–°
async function partialUpdate(userId) {
    const response = await fetch(
        `https://jsonplaceholder.typicode.com/users/${userId}`,
        {
            method: 'PATCH',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name: 'Charlie' })
        }
    );
    
    return await response.json();
}
                </div>
            </div>

            <div class="method-card">
                <h4>DELETE è«‹æ±‚ (åˆªé™¤æ•¸æ“š)</h4>
                <button onclick="demoFetchDELETE()">åŸ·è¡Œ DELETE è«‹æ±‚</button>
                <div class="demo-output" id="fetch-delete-output"></div>
                <div class="code-block">
async function deleteUser(userId) {
    try {
        const response = await fetch(
            `https://jsonplaceholder.typicode.com/users/${userId}`,
            {
                method: 'DELETE'
            }
        );
        
        if (response.ok) {
            console.log('åˆªé™¤æˆåŠŸ');
        } else {
            console.error('åˆªé™¤å¤±æ•—', response.status);
        }
        
    } catch (error) {
        console.error('è«‹æ±‚å¤±æ•—:', error);
    }
}
                </div>
            </div>

            <div class="method-card">
                <h4>Fetch é¸é …å°è±¡</h4>
                <div class="code-block">
const options = {
    method: 'GET', // GET, POST, PUT, PATCH, DELETE
    headers: {
        'Content-Type': 'application/json',
        'Authorization': 'Bearer token',
        'Custom-Header': 'value'
    },
    body: JSON.stringify(data), // POST/PUT/PATCH æ™‚ä½¿ç”¨
    
    // é«˜ç´šé¸é …
    credentials: 'include', // åŒ…å« Cookie
    mode: 'cors', // CORS æ¨¡å¼
    cache: 'no-cache', // ç·©å­˜ç­–ç•¥
    redirect: 'follow', // è·Ÿéš¨é‡å®šå‘
    signal: abortController.signal // å–æ¶ˆè«‹æ±‚
};

const response = await fetch(url, options);
                </div>
            </div>
        </section>

        <!-- ==================== é€²éšæ‡‰ç”¨ ==================== -->
        <section>
            <h2>ğŸŒŸ é€²éšæ‡‰ç”¨</h2>

            <h3>å–æ¶ˆè«‹æ±‚ (Abort)</h3>
            <div class="demo-box">
                <button onclick="demoAbortRequest()" class="btn-success">é–‹å§‹è«‹æ±‚</button>
                <button onclick="cancelAbortRequest()" class="btn-danger">å–æ¶ˆè«‹æ±‚</button>
                <div class="demo-output" id="abort-output"></div>
            </div>

            <div class="code-block">
// å»ºç«‹ AbortController
const controller = new AbortController();

async function fetchWithCancel() {
    try {
        const response = await fetch('/api/long-operation', {
            signal: controller.signal
        });
        const data = await response.json();
    } catch (error) {
        if (error.name === 'AbortError') {
            console.log('è«‹æ±‚å·²å–æ¶ˆ');
        }
    }
}

// å–æ¶ˆè«‹æ±‚
controller.abort();
            </div>

            <h3>è¶…æ™‚æ§åˆ¶</h3>
            <div class="demo-box">
                <button onclick="demoTimeout()">åŸ·è¡Œè¶…æ™‚è«‹æ±‚</button>
                <div class="demo-output" id="timeout-output"></div>
            </div>

            <div class="code-block">
async function fetchWithTimeout(url, timeout = 5000) {
    const controller = new AbortController();
    const id = setTimeout(() => controller.abort(), timeout);
    
    try {
        const response = await fetch(url, {
            signal: controller.signal
        });
        return await response.json();
    } catch (error) {
        if (error.name === 'AbortError') {
            throw new Error('è«‹æ±‚è¶…æ™‚');
        }
        throw error;
    } finally {
        clearTimeout(id);
    }
}

// ä½¿ç”¨
await fetchWithTimeout('/api/data', 5000);
            </div>

            <h3>æ‰¹é‡è«‹æ±‚ç®¡ç†</h3>
            <div class="demo-box">
                <button onclick="demoBatchRequests()">åŸ·è¡Œæ‰¹é‡è«‹æ±‚</button>
                <div class="demo-output" id="batch-output"></div>
            </div>

            <div class="code-block">
// åŒæ™‚è«‹æ±‚å¤šå€‹ç”¨æˆ¶
async function fetchMultipleUsers(userIds) {
    const promises = userIds.map(id =>
        fetch(`https://jsonplaceholder.typicode.com/users/${id}`)
            .then(r => r.json())
    );
    
    return Promise.all(promises);
}

// æœ‰éŒ¯èª¤ç¹¼çºŒåŸ·è¡Œ
async function fetchUsersRobust(userIds) {
    const promises = userIds.map(id =>
        fetch(`https://jsonplaceholder.typicode.com/users/${id}`)
            .then(r => r.json())
            .catch(err => ({ error: id, message: err.message }))
    );
    
    return Promise.all(promises);
}
            </div>

            <h3>è«‹æ±‚éšŠåˆ— (æŒ‰åºåŸ·è¡Œ)</h3>
            <div class="demo-box">
                <button onclick="demoRequestQueue()">åŸ·è¡Œé †åºè«‹æ±‚</button>
                <div class="demo-output" id="queue-output"></div>
            </div>

            <div class="code-block">
// ä¾åºåŸ·è¡Œå¤šå€‹è«‹æ±‚
async function fetchSequentially(urls) {
    const results = [];
    
    for (const url of urls) {
        try {
            const response = await fetch(url);
            const data = await response.json();
            results.push(data);
        } catch (error) {
            results.push({ error: error.message });
        }
    }
    
    return results;
}

// ä½¿ç”¨ reduce
async function fetchSequentiallyWithReduce(urls) {
    return urls.reduce(
        async (acc, url) => {
            const results = await acc;
            const response = await fetch(url);
            const data = await response.json();
            return [...results, data];
        },
        Promise.resolve([])
    );
}
            </div>

            <h3>æ•¸æ“šé åŠ è¼‰ (Preloading)</h3>
            <div class="demo-box">
                <button onclick="demoPreloading()">åŸ·è¡Œé åŠ è¼‰</button>
                <div class="demo-output" id="preload-output"></div>
            </div>

            <div class="code-block">
// åœ¨ç”¨æˆ¶æ“ä½œå‰é åŠ è¼‰æ•¸æ“š
let cachedData = null;

function preloadUserData(userId) {
    if (!cachedData) {
        cachedData = fetch(`/api/users/${userId}`)
            .then(r => r.json());
    }
    return cachedData;
}

async function displayUser(userId) {
    // é åŠ è¼‰å·²ç¶“é–‹å§‹ï¼Œç›´æ¥ await ç·©å­˜çš„ Promise
    const user = await preloadUserData(userId);
    console.log('é¡¯ç¤ºç”¨æˆ¶:', user);
}

// åœ¨ç”¨æˆ¶é»æ“Šå‰é–‹å§‹é åŠ è¼‰
preloadUserData(1);

// ç”¨æˆ¶é»æ“Šæ™‚æ•¸æ“šå¯èƒ½å·²ç¶“æº–å‚™å¥½
setTimeout(() => displayUser(1), 2000);
            </div>
        </section>

        <!-- ==================== å¯¦è¸é …ç›® ==================== -->
        <section>
            <h2>ğŸ’» å¯¦è¸é …ç›®ï¼šç”¨æˆ¶åˆ—è¡¨æ‡‰ç”¨</h2>

            <div class="demo-box">
                <button onclick="loadUsers()" class="btn-success">åŠ è¼‰ç”¨æˆ¶åˆ—è¡¨</button>
                <button onclick="clearUsers()" class="btn-danger">æ¸…ç©º</button>
                <div id="loading-status"></div>
                <div id="users-list"></div>
                <div class="demo-output" id="project-output"></div>
            </div>

            <div class="code-block">
class UserManager {
    constructor() {
        this.users = [];
        this.isLoading = false;
    }
    
    async fetchUsers() {
        this.isLoading = true;
        try {
            const response = await fetch(
                'https://jsonplaceholder.typicode.com/users'
            );
            this.users = await response.json();
            return this.users;
        } catch (error) {
            console.error('åŠ è¼‰å¤±æ•—:', error);
            throw error;
        } finally {
            this.isLoading = false;
        }
    }
    
    async fetchUserWithPosts(userId) {
        const [user, posts] = await Promise.all([
            fetch(`/users/${userId}`).then(r => r.json()),
            fetch(`/posts?userId=${userId}`).then(r => r.json())
        ]);
        return { user, posts };
    }
}

const manager = new UserManager();
await manager.fetchUsers();
            </div>
        </section>

        <!-- ==================== æœ€ä½³å¯¦è¸ ==================== -->
        <section>
            <h2>âš¡ æœ€ä½³å¯¦è¸</h2>

            <div class="description">
                <strong>âœ… æ‡‰è©²åšï¼š</strong><br>
                â€¢ ä½¿ç”¨ async/await æ›¿ä»£ .then()<br>
                â€¢ ç¸½æ˜¯ä½¿ç”¨ try/catch è™•ç†éŒ¯èª¤<br>
                â€¢ é©—è­‰ response.ok æˆ–æª¢æŸ¥ HTTP ç‹€æ…‹<br>
                â€¢ è¨­ç½®è«‹æ±‚è¶…æ™‚<br>
                â€¢ ä½¿ç”¨ AbortController æ”¯æŒå–æ¶ˆ<br>
                â€¢ æª¢æŸ¥ response æ ¼å¼å¾Œå†è§£æ<br>
                â€¢ å¯¦ç¾é‡è©¦æ©Ÿåˆ¶<br>
                â€¢ ä½¿ç”¨ Promise.all() ä¸¦è¡Œè«‹æ±‚
            </div>

            <div class="description" style="background: rgba(245, 87, 108, 0.1); border-left-color: #f5576c;">
                <strong>âŒ é¿å…åšï¼š</strong><br>
                â€¢ åµŒå¥—å¤šå€‹ .then() (å›èª¿åœ°ç„)<br>
                â€¢ å¿˜è¨˜éŒ¯èª¤è™•ç†<br>
                â€¢ å‡è¨­è«‹æ±‚ä¸€å®šæˆåŠŸ<br>
                â€¢ é †åºåŸ·è¡Œå¯ä¸¦è¡Œçš„è«‹æ±‚<br>
                â€¢ å¿½è¦– CORS å•é¡Œ<br>
                â€¢ åœ¨å…¨å±€ä½œç”¨åŸŸç™¼èµ·è«‹æ±‚<br>
                â€¢ å¿˜è¨˜å–æ¶ˆè¨‚é–±æˆ–æ¸…ç†<br>
                â€¢ æ²’æœ‰è¶…æ™‚ä¿è­·
            </div>

            <h3>å¸¸è¦‹éŒ¯èª¤ç¯„ä¾‹</h3>
            <div class="demo-box">
                <button onclick="demoCommonMistakes()">æŸ¥çœ‹å¸¸è¦‹éŒ¯èª¤</button>
                <div class="demo-output" id="mistakes-output"></div>
            </div>

            <div class="code-block">
// âŒ éŒ¯èª¤ 1ï¼šæ²’æœ‰è™•ç†éŒ¯èª¤
fetch('/api/data')
    .then(r => r.json())
    .then(data => console.log(data));

// âœ… æ­£ç¢º
async function getData() {
    try {
        const response = await fetch('/api/data');
        if (!response.ok) throw new Error(`HTTP ${response.status}`);
        return await response.json();
    } catch (error) {
        console.error('å¤±æ•—:', error);
    }
}

// âŒ éŒ¯èª¤ 2ï¼šé †åºåŸ·è¡Œå°è‡´è€—æ™‚é•·
const user = await fetchUser(1); // 1ç§’
const posts = await fetchPosts(user.id); // 1ç§’
// ç¸½è€—æ™‚: 2ç§’

// âœ… æ­£ç¢ºï¼šä¸¦è¡ŒåŸ·è¡Œ
const [user, posts] = await Promise.all([
    fetchUser(1),
    fetchPosts(1)
]);
// ç¸½è€—æ™‚: 1ç§’

// âŒ éŒ¯èª¤ 3ï¼šæ²’æœ‰é©—è­‰ JSON
const data = await response.json(); // å¯èƒ½å¤±æ•—

// âœ… æ­£ç¢ºï¼šé©—è­‰ Content-Type
const contentType = response.headers.get('content-type');
if (contentType?.includes('application/json')) {
    const data = await response.json();
}
            </div>
        </section>
    </div>

    <footer>
        <p>JavaScript éåŒæ­¥è™•ç†èˆ‡ API å­¸ç¿’æ•™ç¨‹ | 2026</p>
        <p>æŒæ¡éåŒæ­¥ç·¨ç¨‹ï¼Œæå‡é–‹ç™¼æ•ˆç‡ âœ¨</p>
    </footer>

    <script>
        // ==================== åŸºç¤ç¤ºç¯„ ====================
        function demoSynchronous() {
            let output = "åŒæ­¥åŸ·è¡Œç¤ºç¯„\n";
            output += "==================\n\n";
            
            const start = performance.now();
            output += "é–‹å§‹æ™‚é–“: " + new Date().toLocaleTimeString() + "\n";
            
            // æ¨¡æ“¬è€—æ™‚æ“ä½œ
            let sum = 0;
            for (let i = 0; i < 100000000; i++) {
                sum += i;
            }
            
            const elapsed = (performance.now() - start).toFixed(2);
            output += "çµæŸæ™‚é–“: " + new Date().toLocaleTimeString() + "\n";
            output += `è€—æ™‚: ${elapsed} ms\n\n`;
            output += "å•é¡Œ: ç¨‹åºè¢«é˜»å¡ï¼ŒUI ç„¡éŸ¿æ‡‰";
            
            document.getElementById('sync-async-output').textContent = output;
        }

        function demoAsynchronous() {
            let output = "éåŒæ­¥åŸ·è¡Œç¤ºç¯„\n";
            output += "==================\n\n";
            
            output += "é–‹å§‹æ™‚é–“: " + new Date().toLocaleTimeString() + "\n";
            output += "å•Ÿå‹•éåŒæ­¥æ“ä½œ...\n";
            
            setTimeout(() => {
                output += "çµæŸæ™‚é–“: " + new Date().toLocaleTimeString() + "\n";
                output += "è€—æ™‚: ç´„ 1000ms\n\n";
                output += "å„ªé»: UI ä¿æŒéŸ¿æ‡‰ï¼Œä»£ç¢¼å¯ä»¥ç¹¼çºŒåŸ·è¡Œ";
                document.getElementById('sync-async-output').textContent = output;
            }, 1000);
            
            document.getElementById('sync-async-output').textContent = output;
        }

        // ==================== å›èª¿ç¤ºç¯„ ====================
        function demoCallback() {
            let output = "å›èª¿å‡½æ•¸ç¤ºç¯„\n";
            output += "==================\n\n";
            
            document.getElementById('callback-output').textContent = output + "åŠ è¼‰ä¸­...";
            
            function fetchData(callback) {
                setTimeout(() => {
                    const data = { id: 1, name: 'Alice', age: 25 };
                    callback(data);
                }, 1000);
            }
            
            fetchData((data) => {
                output += "ç²å¾—æ•¸æ“š:\n";
                output += JSON.stringify(data, null, 2);
                document.getElementById('callback-output').textContent = output;
            });
        }

        // ==================== Promise ç¤ºç¯„ ====================
        function demoPromiseStates() {
            let output = "Promise ç‹€æ…‹æ¼”ç¤º\n";
            output += "==================\n\n";
            
            document.getElementById('promise-states-output').textContent = output + "åŸ·è¡Œä¸­...";
            
            const promise = new Promise((resolve, reject) => {
                setTimeout(() => {
                    if (Math.random() > 0.5) {
                        resolve('âœ… æˆåŠŸå®Œæˆ!');
                    } else {
                        reject('âŒ å¤±æ•—!');
                    }
                }, 1000);
            });
            
            promise
                .then(result => {
                    output += "ç‹€æ…‹: Fulfilled (æˆåŠŸ)\n";
                    output += "çµæœ: " + result;
                    document.getElementById('promise-states-output').textContent = output;
                })
                .catch(error => {
                    output += "ç‹€æ…‹: Rejected (å¤±æ•—)\n";
                    output += "éŒ¯èª¤: " + error;
                    document.getElementById('promise-states-output').textContent = output;
                });
        }

        function demoPromiseChain() {
            let output = "Promise éˆå¼èª¿ç”¨\n";
            output += "==================\n\n";
            
            document.getElementById('promise-chain-output').textContent = output + "åŸ·è¡Œä¸­...";
            
            // æ¨¡æ“¬ API èª¿ç”¨
            function fetchUser(id) {
                return new Promise(resolve => {
                    setTimeout(() => resolve({ id, name: 'Alice' }), 500);
                });
            }
            
            function fetchPosts(userId) {
                return new Promise(resolve => {
                    setTimeout(() => resolve([
                        { id: 1, title: 'æ–‡ç« 1' },
                        { id: 2, title: 'æ–‡ç« 2' }
                    ]), 500);
                });
            }
            
            fetchUser(1)
                .then(user => {
                    output += `ç¬¬ 1 æ­¥: ç²å¾—ç”¨æˆ¶\n${JSON.stringify(user)}\n\n`;
                    return fetchPosts(user.id);
                })
                .then(posts => {
                    output += `ç¬¬ 2 æ­¥: ç²å¾—æ–‡ç« \n${JSON.stringify(posts, null, 2)}\n\n`;
                    output += "âœ… éˆå¼èª¿ç”¨å®Œæˆ!";
                    document.getElementById('promise-chain-output').textContent = output;
                })
                .catch(error => {
                    output += "âŒ ç™¼ç”ŸéŒ¯èª¤: " + error;
                    document.getElementById('promise-chain-output').textContent = output;
                });
        }

        function demoPromiseAll() {
            let output = "Promise.all() æ¼”ç¤º\n";
            output += "==================\n\n";
            
            document.getElementById('promise-all-output').textContent = output + "åŒæ™‚åŠ è¼‰ 3 å€‹æ•¸æ“šæº...";
            
            const p1 = new Promise(resolve => setTimeout(() => resolve('æ•¸æ“š1'), 500));
            const p2 = new Promise(resolve => setTimeout(() => resolve('æ•¸æ“š2'), 800));
            const p3 = new Promise(resolve => setTimeout(() => resolve('æ•¸æ“š3'), 600));
            
            Promise.all([p1, p2, p3])
                .then(results => {
                    output += `ä¸¦è¡Œçµæœ:\n`;
                    results.forEach((r, i) => {
                        output += `  [${i}]: ${r}\n`;
                    });
                    output += "\nâ±ï¸ ç¸½è€—æ™‚: ç´„ 800ms (æœ€é•·çš„é‚£å€‹)";
                    document.getElementById('promise-all-output').textContent = output;
                });
        }

        function demoPromiseRace() {
            let output = "Promise.race() æ¼”ç¤º\n";
            output += "==================\n\n";
            
            document.getElementById('promise-race-output').textContent = output + "ç«¶é€ŸåŸ·è¡Œ...";
            
            const p1 = new Promise(resolve => setTimeout(() => resolve('é¦–å…ˆå®Œæˆ'), 800));
            const p2 = new Promise(resolve => setTimeout(() => resolve('æ¬¡åºå®Œæˆ'), 1000));
            const p3 = new Promise(resolve => setTimeout(() => resolve('æœ€å¾Œå®Œæˆ'), 1200));
            
            Promise.race([p1, p2, p3])
                .then(result => {
                    output += `é¦–å€‹å®Œæˆ: ${result}\n\n`;
                    output += "å…¶ä»– Promise ä»åœ¨é‹è¡Œï¼Œä½†çµæœè¢«å¿½è¦–";
                    document.getElementById('promise-race-output').textContent = output;
                });
        }

        function demoPromiseAllSettled() {
            let output = "Promise.allSettled() æ¼”ç¤º\n";
            output += "==================\n\n";
            
            document.getElementById('promise-allsettled-output').textContent = output + "åŸ·è¡Œä¸­...";
            
            const p1 = new Promise(resolve => setTimeout(() => resolve('æˆåŠŸ1'), 400));
            const p2 = new Promise((_, reject) => setTimeout(() => reject('å¤±æ•—!'), 500));
            const p3 = new Promise(resolve => setTimeout(() => resolve('æˆåŠŸ2'), 600));
            
            Promise.allSettled([p1, p2, p3])
                .then(results => {
                    output += "çµæœ:\n";
                    results.forEach((r, i) => {
                        if (r.status === 'fulfilled') {
                            output += `  [${i}] âœ… ${r.value}\n`;
                        } else {
                            output += `  [${i}] âŒ ${r.reason}\n`;
                        }
                    });
                    document.getElementById('promise-allsettled-output').textContent = output;
                });
        }

        function demoPromiseAny() {
            let output = "Promise.any() æ¼”ç¤º\n";
            output += "==================\n\n";
            
            document.getElementById('promise-any-output').textContent = output + "åŸ·è¡Œä¸­...";
            
            const p1 = new Promise((_, reject) => setTimeout(() => reject('å¤±æ•—1'), 400));
            const p2 = new Promise(resolve => setTimeout(() => resolve('æˆåŠŸ!'), 500));
            const p3 = new Promise((_, reject) => setTimeout(() => reject('å¤±æ•—2'), 600));
            
            Promise.any([p1, p2, p3])
                .then(result => {
                    output += `âœ… é¦–å€‹æˆåŠŸ: ${result}\n\n`;
                    output += "å³ä½¿æœ‰ Promise å¤±æ•—ï¼Œåªè¦æœ‰ä¸€å€‹æˆåŠŸå°±è¿”å›";
                    document.getElementById('promise-any-output').textContent = output;
                });
        }

        // ==================== Async/Await ç¤ºç¯„ ====================
        async function demoAsyncAwaitBasic() {
            let output = "Async/Await åŸºæœ¬ç¤ºç¯„\n";
            output += "==================\n\n";
            
            document.getElementById('async-await-basic-output').textContent = output + "åŸ·è¡Œä¸­...";
            
            function delay(ms, value) {
                return new Promise(resolve => setTimeout(() => resolve(value), ms));
            }
            
            try {
                output += "æ­¥é©Ÿ 1: ç²å–ç”¨æˆ¶ä¿¡æ¯\n";
                const user = await delay(500, { id: 1, name: 'Alice' });
                output += JSON.stringify(user) + "\n\n";
                
                output += "æ­¥é©Ÿ 2: ç²å–ç”¨æˆ¶æ–‡ç« \n";
                const posts = await delay(500, [{ id: 1, title: 'æ–‡ç«  1' }]);
                output += JSON.stringify(posts, null, 2) + "\n\n";
                
                output += "âœ… å…¨éƒ¨å®Œæˆ!";
            } catch (error) {
                output += "âŒ éŒ¯èª¤: " + error;
            }
            
            document.getElementById('async-await-basic-output').textContent = output;
        }

        async function demoParallelExecution() {
            let output = "ä¸¦è¡ŒåŸ·è¡Œç¤ºç¯„\n";
            output += "==================\n\n";
            
            document.getElementById('parallel-output').textContent = output + "åŸ·è¡Œä¸­...";
            
            function delay(ms, value) {
                return new Promise(resolve => setTimeout(() => resolve(value), ms));
            }
            
            const start = performance.now();
            
            // ä¸¦è¡ŒåŸ·è¡Œ
            const [user, posts, comments] = await Promise.all([
                delay(500, 'ç”¨æˆ¶æ•¸æ“š'),
                delay(600, 'æ–‡ç« æ•¸æ“š'),
                delay(700, 'è©•è«–æ•¸æ“š')
            ]);
            
            const elapsed = (performance.now() - start).toFixed(0);
            
            output += "ä¸¦è¡Œç²å– 3 å€‹æ•¸æ“š:\n";
            output += `- ç”¨æˆ¶: ${user}\n`;
            output += `- æ–‡ç« : ${posts}\n`;
            output += `- è©•è«–: ${comments}\n\n`;
            output += `â±ï¸ ç¸½è€—æ™‚: ${elapsed}ms (ç´„ç­‰æ–¼æœ€é•·çš„ 700ms)`;
            
            document.getElementById('parallel-output').textContent = output;
        }

        async function demoErrorHandling() {
            let output = "éŒ¯èª¤è™•ç†ç¤ºç¯„\n";
            output += "==================\n\n";
            
            document.getElementById('error-handling-output').textContent = output + "åŸ·è¡Œä¸­...";
            
            function unreliableFetch() {
                return new Promise((resolve, reject) => {
                    setTimeout(() => {
                        if (Math.random() > 0.5) {
                            resolve({ data: 'æˆåŠŸ' });
                        } else {
                            reject(new Error('ç¶²çµ¡éŒ¯èª¤'));
                        }
                    }, 500);
                });
            }
            
            try {
                output += "å˜—è©¦ç²å–æ•¸æ“š...\n";
                const response = await unreliableFetch();
                output += `âœ… æˆåŠŸ: ${JSON.stringify(response)}`;
            } catch (error) {
                output += `âŒ éŒ¯èª¤: ${error.message}`;
            } finally {
                output += "\n\nâœ“ æ¸…ç†å·¥ä½œå®Œæˆ";
            }
            
            document.getElementById('error-handling-output').textContent = output;
        }

        async function demoRetryLogic() {
            let output = "é‡è©¦æ©Ÿåˆ¶ç¤ºç¯„\n";
            output += "==================\n\n";
            
            document.getElementById('retry-output').textContent = output + "é–‹å§‹é‡è©¦...";
            
            async function unreliableOperation() {
                if (Math.random() > 0.3) {
                    throw new Error('éš¨æ©Ÿå¤±æ•—');
                }
                return 'Success!';
            }
            
            async function retryWithBackoff(fn, maxRetries = 3) {
                for (let i = 0; i < maxRetries; i++) {
                    try {
                        output += `å˜—è©¦ ${i + 1}/${maxRetries}\n`;
                        const result = await fn();
                        output += `âœ… æˆåŠŸ: ${result}`;
                        return result;
                    } catch (error) {
                        if (i === maxRetries - 1) {
                            output += `âŒ æœ€çµ‚å¤±æ•—: ${error.message}`;
                            throw error;
                        }
                        const delay = 1000 * (i + 1);
                        output += `ç­‰å¾… ${delay}ms å¾Œé‡è©¦...\n`;
                        await new Promise(r => setTimeout(r, delay));
                    }
                }
            }
            
            try {
                await retryWithBackoff(unreliableOperation, 3);
            } catch (e) {
                // è™•ç†æœ€çµ‚å¤±æ•—
            }
            
            document.getElementById('retry-output').textContent = output;
        }

        // ==================== Fetch API ç¤ºç¯„ ====================
        async function demoFetchGET() {
            let output = "GET è«‹æ±‚ç¤ºç¯„\n";
            output += "==================\n\n";
            
            document.getElementById('fetch-get-output').textContent = output + "ç™¼é€è«‹æ±‚ä¸­...";
            
            try {
                output += "URL: https://jsonplaceholder.typicode.com/users/1\n\n";
                
                const response = await fetch('https://jsonplaceholder.typicode.com/users/1');
                
                output += `ç‹€æ…‹ç¢¼: ${response.status}\n`;
                output += `ç‹€æ…‹æ–‡æœ¬: ${response.statusText}\n`;
                output += `OK: ${response.ok}\n\n`;
                
                const data = await response.json();
                output += "éŸ¿æ‡‰æ•¸æ“š:\n";
                output += JSON.stringify(data, null, 2);
                
            } catch (error) {
                output += `âŒ è«‹æ±‚å¤±æ•—: ${error.message}`;
            }
            
            document.getElementById('fetch-get-output').textContent = output;
        }

        async function demoFetchPOST() {
            let output = "POST è«‹æ±‚ç¤ºç¯„\n";
            output += "==================\n\n";
            
            document.getElementById('fetch-post-output').textContent = output + "ç™¼é€è«‹æ±‚ä¸­...";
            
            try {
                const newUser = {
                    name: 'Alice',
                    email: 'alice@example.com',
                    phone: '123-456-7890'
                };
                
                output += "ç™¼é€æ•¸æ“š:\n";
                output += JSON.stringify(newUser, null, 2) + "\n\n";
                
                const response = await fetch(
                    'https://jsonplaceholder.typicode.com/users',
                    {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(newUser)
                    }
                );
                
                const result = await response.json();
                output += "æœå‹™å™¨éŸ¿æ‡‰:\n";
                output += JSON.stringify(result, null, 2);
                
            } catch (error) {
                output += `âŒ è«‹æ±‚å¤±æ•—: ${error.message}`;
            }
            
            document.getElementById('fetch-post-output').textContent = output;
        }

        async function demoFetchPUT() {
            let output = "PUT è«‹æ±‚ç¤ºç¯„\n";
            output += "==================\n\n";
            
            document.getElementById('fetch-put-output').textContent = output + "ç™¼é€è«‹æ±‚ä¸­...";
            
            try {
                const userId = 1;
                const updatedUser = {
                    id: userId,
                    name: 'Bob Updated',
                    email: 'bob@example.com'
                };
                
                output += `æ›´æ–°ç”¨æˆ¶ ${userId}\n\n`;
                output += "æ–°æ•¸æ“š:\n";
                output += JSON.stringify(updatedUser, null, 2) + "\n\n";
                
                const response = await fetch(
                    `https://jsonplaceholder.typicode.com/users/${userId}`,
                    {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(updatedUser)
                    }
                );
                
                const result = await response.json();
                output += "æ›´æ–°çµæœ:\n";
                output += JSON.stringify(result, null, 2);
                
            } catch (error) {
                output += `âŒ è«‹æ±‚å¤±æ•—: ${error.message}`;
            }
            
            document.getElementById('fetch-put-output').textContent = output;
        }

        async function demoFetchDELETE() {
            let output = "DELETE è«‹æ±‚ç¤ºç¯„\n";
            output += "==================\n\n";
            
            document.getElementById('fetch-delete-output').textContent = output + "ç™¼é€è«‹æ±‚ä¸­...";
            
            try {
                const userId = 1;
                output += `åˆªé™¤ç”¨æˆ¶ ${userId}\n\n`;
                
                const response = await fetch(
                    `https://jsonplaceholder.typicode.com/users/${userId}`,
                    {
                        method: 'DELETE'
                    }
                );
                
                output += `ç‹€æ…‹ç¢¼: ${response.status}\n`;
                output += `æˆåŠŸ: ${response.ok}\n\n`;
                
                if (response.ok) {
                    output += "âœ… åˆªé™¤æˆåŠŸ";
                } else {
                    output += `âŒ åˆªé™¤å¤±æ•—: ${response.status}`;
                }
                
            } catch (error) {
                output += `âŒ è«‹æ±‚å¤±æ•—: ${error.message}`;
            }
            
            document.getElementById('fetch-delete-output').textContent = output;
        }

        // ==================== é€²éšç¤ºç¯„ ====================
        let abortController = null;

        async function demoAbortRequest() {
            let output = "å–æ¶ˆè«‹æ±‚ç¤ºç¯„\n";
            output += "==================\n\n";
            
            document.getElementById('abort-output').textContent = output + "ç™¼é€é•·æ™‚é–“è«‹æ±‚ä¸­...";
            
            abortController = new AbortController();
            
            try {
                output += "æ¨¡æ“¬ 10 ç§’é•·æ™‚é–“æ“ä½œ...\n";
                output += "(é»æ“Š 'å–æ¶ˆè«‹æ±‚' æŒ‰éˆ•ä¾†ä¸­æ­¢)\n\n";
                
                // æ¨¡æ“¬é•·æ™‚é–“æ“ä½œ
                const promise = new Promise((resolve, reject) => {
                    const timeout = setTimeout(() => {
                        resolve('âœ… æ“ä½œå®Œæˆ');
                    }, 10000);
                    
                    abortController.signal.addEventListener('abort', () => {
                        clearTimeout(timeout);
                        reject(new Error('æ“ä½œè¢«å–æ¶ˆ'));
                    });
                });
                
                const result = await promise;
                output += result;
                
            } catch (error) {
                output += `âŒ ${error.message}`;
            }
            
            document.getElementById('abort-output').textContent = output;
        }

        function cancelAbortRequest() {
            if (abortController) {
                abortController.abort();
            }
        }

        async function demoTimeout() {
            let output = "è¶…æ™‚æ§åˆ¶ç¤ºç¯„\n";
            output += "==================\n\n";
            
            document.getElementById('timeout-output').textContent = output + "ç™¼é€è«‹æ±‚ä¸­...";
            
            async function fetchWithTimeout(url, timeout = 3000) {
                const controller = new AbortController();
                const id = setTimeout(() => controller.abort(), timeout);
                
                try {
                    const response = await fetch(url, {
                        signal: controller.signal
                    });
                    return await response.json();
                } catch (error) {
                    if (error.name === 'AbortError') {
                        throw new Error(`è«‹æ±‚è¶…æ™‚ (${timeout}ms)`);
                    }
                    throw error;
                } finally {
                    clearTimeout(id);
                }
            }
            
            try {
                output += "è¨­ç½® 3 ç§’è¶…æ™‚...\n";
                const data = await fetchWithTimeout(
                    'https://jsonplaceholder.typicode.com/users/1',
                    3000
                );
                output += "âœ… è«‹æ±‚æˆåŠŸ:\n";
                output += JSON.stringify(data, null, 2);
            } catch (error) {
                output += `âŒ ${error.message}`;
            }
            
            document.getElementById('timeout-output').textContent = output;
        }

        async function demoBatchRequests() {
            let output = "æ‰¹é‡è«‹æ±‚ç¤ºç¯„\n";
            output += "==================\n\n";
            
            document.getElementById('batch-output').textContent = output + "ç™¼é€ 5 å€‹ä¸¦è¡Œè«‹æ±‚...";
            
            try {
                const userIds = [1, 2, 3, 4, 5];
                
                output += `è«‹æ±‚ç”¨æˆ¶ IDs: [${userIds.join(', ')}]\n\n`;
                
                const promises = userIds.map(id =>
                    fetch(`https://jsonplaceholder.typicode.com/users/${id}`)
                        .then(r => r.json())
                );
                
                const users = await Promise.all(promises);
                
                output += "çµæœ:\n";
                users.forEach(user => {
                    output += `  - ${user.name} (${user.email})\n`;
                });
                
            } catch (error) {
                output += `âŒ è«‹æ±‚å¤±æ•—: ${error.message}`;
            }
            
            document.getElementById('batch-output').textContent = output;
        }

        async function demoRequestQueue() {
            let output = "é †åºè«‹æ±‚ç¤ºç¯„\n";
            output += "==================\n\n";
            
            document.getElementById('queue-output').textContent = output + "é †åºç™¼é€è«‹æ±‚...";
            
            try {
                const userIds = [1, 2, 3];
                output += `ä¾åºè«‹æ±‚ç”¨æˆ¶: [${userIds.join(', ')}]\n\n`;
                
                const results = [];
                
                for (let i = 0; i < userIds.length; i++) {
                    const userId = userIds[i];
                    output += `[${i + 1}/${userIds.length}] ç²å–ç”¨æˆ¶ ${userId}...`;
                    
                    const response = await fetch(
                        `https://jsonplaceholder.typicode.com/users/${userId}`
                    );
                    const user = await response.json();
                    results.push(user);
                    
                    output += ` âœ…\n`;
                }
                
                output += "\nçµæœ:\n";
                results.forEach(user => {
                    output += `  - ${user.name}\n`;
                });
                
            } catch (error) {
                output += `âŒ è«‹æ±‚å¤±æ•—: ${error.message}`;
            }
            
            document.getElementById('queue-output').textContent = output;
        }

        async function demoPreloading() {
            let output = "æ•¸æ“šé åŠ è¼‰ç¤ºç¯„\n";
            output += "==================\n\n";
            
            document.getElementById('preload-output').textContent = output + "æ¼”ç¤ºä¸­...";
            
            let cachedData = null;
            
            function preloadUserData(userId) {
                if (!cachedData) {
                    output += "ğŸ”„ é–‹å§‹é åŠ è¼‰ç”¨æˆ¶ 1 çš„æ•¸æ“š...\n";
                    cachedData = fetch(`https://jsonplaceholder.typicode.com/users/1`)
                        .then(r => r.json());
                }
                return cachedData;
            }
            
            async function displayUser() {
                output += "â³ ç­‰å¾… 2 ç§’å¾Œé¡¯ç¤ºç”¨æˆ¶...\n\n";
                await new Promise(r => setTimeout(r, 2000));
                
                const user = await preloadUserData(1);
                output += `âœ… ç”¨æˆ¶æ•¸æ“šå·²æº–å‚™: ${user.name}`;
            }
            
            // ç«‹å³é–‹å§‹é åŠ è¼‰
            preloadUserData(1);
            
            // 2 ç§’å¾Œé¡¯ç¤º
            await displayUser();
            
            document.getElementById('preload-output').textContent = output;
        }

        // ==================== é …ç›®ç¤ºç¯„ ====================
        async function loadUsers() {
            const statusEl = document.getElementById('loading-status');
            const listEl = document.getElementById('users-list');
            
            statusEl.innerHTML = '<span class="loading"></span>åŠ è¼‰ä¸­...';
            listEl.innerHTML = '';
            
            try {
                const response = await fetch(
                    'https://jsonplaceholder.typicode.com/users?_limit=5'
                );
                const users = await response.json();
                
                statusEl.innerHTML = '<span class="status-badge status-success">âœ… å·²åŠ è¼‰</span>';
                
                let html = '<div style="display: grid; gap: 10px; margin-top: 15px;">';
                users.forEach(user => {
                    html += `
                        <div style="background: #f5f5f5; padding: 12px; border-radius: 8px;">
                            <strong>${user.name}</strong><br/>
                            ğŸ“§ ${user.email}<br/>
                            ğŸŒ ${user.website}
                        </div>
                    `;
                });
                html += '</div>';
                
                listEl.innerHTML = html;
                
            } catch (error) {
                statusEl.innerHTML = '<span class="status-badge status-error">âŒ åŠ è¼‰å¤±æ•—</span>';
                listEl.innerHTML = `<div style="color: #721c24; padding: 10px;">éŒ¯èª¤: ${error.message}</div>`;
            }
        }

        function clearUsers() {
            document.getElementById('loading-status').innerHTML = '';
            document.getElementById('users-list').innerHTML = '';
        }

        function demoCommonMistakes() {
            let output = "å¸¸è¦‹éŒ¯èª¤ç¤ºç¯„\n";
            output += "==================\n\n";
            
            output += "âŒ éŒ¯èª¤ 1: æ²’æœ‰é©—è­‰ç‹€æ…‹ç¢¼\n";
            output += "fetch('/api/data')\n";
            output += "    .then(r => r.json())\n";
            output += "    .then(data => console.log(data));\n\n";
            
            output += "âœ… æ­£ç¢ºåšæ³•:\n";
            output += "const response = await fetch('/api/data');\n";
            output += "if (!response.ok) throw new Error(response.status);\n";
            output += "const data = await response.json();\n\n";
            
            output += "âŒ éŒ¯èª¤ 2: é †åºåŸ·è¡Œå°è‡´æ…¢\n";
            output += "const a = await fetch(...); // 1ç§’\n";
            output += "const b = await fetch(...); // 1ç§’\n";
            output += "// ç¸½è€—æ™‚: 2ç§’\n\n";
            
            output += "âœ… æ­£ç¢ºåšæ³•:\n";
            output += "const [a, b] = await Promise.all([\n";
            output += "    fetch(...),\n";
            output += "    fetch(...)\n";
            output += "]);\n";
            output += "// ç¸½è€—æ™‚: 1ç§’\n";
            
            document.getElementById('mistakes-output').textContent = output;
        }
    </script>
</body>
</html>